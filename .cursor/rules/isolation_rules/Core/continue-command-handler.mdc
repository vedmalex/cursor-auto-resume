---
description: "Always apply this rule when processing CONTINUE commands to provide intelligent context recovery, analyze current tasks in empty chat sessions, and offer appropriate mode selection to users."
globs: "**/**"
alwaysApply: true
---

# CONTINUE COMMAND HANDLER SYSTEM

> **TL;DR:** –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã –ü–†–û–î–û–õ–ñ–ê–ô –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á –ø—Ä–∏ –ø—É—Å—Ç–æ–º —á–∞—Ç–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

## üîÑ –ü–†–ò–ù–¶–ò–ü–´ –û–ë–†–ê–ë–û–¢–ö–ò –ö–û–ú–ê–ù–î–´ –ü–†–û–î–û–õ–ñ–ê–ô

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
**–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Å —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —á–∞—Ç–∞**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –≤ Memory Bank
- –ê–Ω–∞–ª–∏–∑ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Å–ª–µ–¥—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

## üéØ –ê–õ–ì–û–†–ò–¢–ú –û–ë–†–ê–ë–û–¢–ö–ò –ö–û–ú–ê–ù–î–´ –ü–†–û–î–û–õ–ñ–ê–ô

### –û—Å–Ω–æ–≤–Ω–æ–π workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã –ü–†–û–î–û–õ–ñ–ê–ô
handle_continue_command() {
  echo "üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ú–ê–ù–î–´ –ü–†–û–î–û–õ–ñ–ê–ô"
  echo "============================="

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
  local system_state=$(analyze_system_state)
  echo "üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã: $system_state"

  case "$system_state" in
    "active_task")
      handle_active_task_continuation
      ;;
    "empty_chat")
      handle_empty_chat_continuation
      ;;
    "interrupted_session")
      handle_interrupted_session_continuation
      ;;
    "new_session")
      handle_new_session_continuation
      ;;
    *)
      handle_unknown_state_continuation
      ;;
  esac
}
```

### –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
```bash
# –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è Memory Bank —Å–∏—Å—Ç–µ–º—ã
analyze_system_state() {
  local tasks_file="memory-bank/tasks.md"
  local context_file="memory-bank/activeContext.md"
  local progress_file="memory-bank/progress.md"

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
  if [ -f "$tasks_file" ]; then
    local active_tasks=$(grep -c "–ê–ö–¢–ò–í–ù–ê–Ø –ó–ê–î–ê–ß–ê:" "$tasks_file" 2>/dev/null || echo "0")
    if [ "$active_tasks" -gt 0 ]; then
      echo "active_task"
      return 0
    fi
  fi

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  if [ -f "$context_file" ]; then
    local context_size=$(wc -l < "$context_file" 2>/dev/null || echo "0")
    if [ "$context_size" -gt 10 ]; then
      echo "interrupted_session"
      return 0
    fi
  fi

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  if [ -f "$progress_file" ]; then
    local progress_entries=$(grep -c "%" "$progress_file" 2>/dev/null || echo "0")
    if [ "$progress_entries" -gt 0 ]; then
      echo "interrupted_session"
      return 0
    fi
  fi

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Memory Bank —Ñ–∞–π–ª–æ–≤
  if [ -d "memory-bank" ]; then
    echo "empty_chat"
  else
    echo "new_session"
  fi
}
```

## üìã –û–ë–†–ê–ë–û–¢–ö–ê –ê–ö–¢–ò–í–ù–´–• –ó–ê–î–ê–ß

### –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏
```bash
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏
handle_active_task_continuation() {
  echo "üìã –û–ë–ù–ê–†–£–ñ–ï–ù–ê –ê–ö–¢–ò–í–ù–ê–Ø –ó–ê–î–ê–ß–ê"
  echo "============================"

  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–µ
  local task_info=$(extract_active_task_info)
  local task_name=$(echo "$task_info" | head -1)
  local task_status=$(echo "$task_info" | tail -1)

  echo "üìù –ê–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞: $task_name"
  echo "üìä –°—Ç–∞—Ç—É—Å: $task_status"

  # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–¥–∞—á–∏
  local progress_analysis=$(analyze_task_progress "$task_name")
  echo "üìà –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:"
  echo "$progress_analysis"

  # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤
  local next_steps=$(determine_next_steps "$task_name" "$task_status")
  echo "üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
  echo "$next_steps"

  # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
  echo ""
  echo "üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è:"
  echo "1. IMPLEMENT - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é"
  echo "2. PLAN - –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω"
  echo "3. VAN - –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è"
  echo "4. CREATIVE - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º"
  echo "5. REFLECT - –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã"

  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞
  local recommended_mode=$(recommend_mode_for_task "$task_status")
  echo "üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º: $recommended_mode"

  read -p "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º (1-5) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ: " mode_choice

  case "${mode_choice:-$recommended_mode}" in
    "1"|"IMPLEMENT"|"implement")
      echo "‚öôÔ∏è –ü–µ—Ä–µ—Ö–æ–¥ –≤ IMPLEMENT —Ä–µ–∂–∏–º"
      start_implement_mode "$task_name"
      ;;
    "2"|"PLAN"|"plan")
      echo "üìã –ü–µ—Ä–µ—Ö–æ–¥ –≤ PLAN —Ä–µ–∂–∏–º"
      start_plan_mode "$task_name"
      ;;
    "3"|"VAN"|"van")
      echo "üîç –ü–µ—Ä–µ—Ö–æ–¥ –≤ VAN —Ä–µ–∂–∏–º"
      start_van_mode
      ;;
    "4"|"CREATIVE"|"creative")
      echo "üé® –ü–µ—Ä–µ—Ö–æ–¥ –≤ CREATIVE —Ä–µ–∂–∏–º"
      start_creative_mode "$task_name"
      ;;
    "5"|"REFLECT"|"reflect")
      echo "ü§î –ü–µ—Ä–µ—Ö–æ–¥ –≤ REFLECT —Ä–µ–∂–∏–º"
      start_reflect_mode "$task_name"
      ;;
    *)
      echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ —Ä–µ–∂–∏–º–∞: $recommended_mode"
      handle_mode_selection "$recommended_mode" "$task_name"
      ;;
  esac
}
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–¥–∞—á–µ
```bash
# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–µ
extract_active_task_info() {
  local tasks_file="memory-bank/tasks.md"

  if [ ! -f "$tasks_file" ]; then
    echo "–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    echo "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
    return 1
  fi

  # –ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏
  local task_section=$(sed -n '/## üéØ –ê–ö–¢–ò–í–ù–ê–Ø –ó–ê–î–ê–ß–ê:/,/^## /p' "$tasks_file" | head -n -1)

  if [ -z "$task_section" ]; then
    echo "–ê–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    echo "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
    return 1
  fi

  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
  local task_name=$(echo "$task_section" | grep "**–ù–∞–∑–≤–∞–Ω–∏–µ**:" | sed 's/.*: //')

  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
  local task_status=$(echo "$task_section" | grep "**–°—Ç–∞—Ç—É—Å**:" | sed 's/.*: //')

  echo "$task_name"
  echo "$task_status"
}
```

## üí≠ –û–ë–†–ê–ë–û–¢–ö–ê –ü–£–°–¢–û–ì–û –ß–ê–¢–ê

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —á–∞—Ç–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏
```bash
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã –ü–†–û–î–û–õ–ñ–ê–ô –ø—Ä–∏ –ø—É—Å—Ç–æ–º —á–∞—Ç–µ
handle_empty_chat_continuation() {
  echo "üí≠ –û–ë–†–ê–ë–û–¢–ö–ê –ü–£–°–¢–û–ì–û –ß–ê–¢–ê"
  echo "========================"

  # –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á –≤ Memory Bank
  local all_tasks=$(find_all_tasks)

  if [ -n "$all_tasks" ]; then
    echo "üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ Memory Bank:"
    echo "$all_tasks"
    echo ""

    # –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    local last_activity=$(analyze_last_activity)
    echo "üïí –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: $last_activity"

    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    echo "üîÑ –í–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã:"
    echo "1. –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–¥–∞—á—É"
    echo "2. –í—ã–±—Ä–∞—Ç—å –∑–∞–¥–∞—á—É –∏–∑ —Å–ø–∏—Å–∫–∞"
    echo "3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É"
    echo "4. –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (VAN)"
    echo "5. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã (PLAN)"

    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç (1-5): " continuation_choice

    case "$continuation_choice" in
      "1")
        resume_last_task
        ;;
      "2")
        select_task_from_list
        ;;
      "3")
        create_new_task
        ;;
      "4")
        start_van_mode
        ;;
      "5")
        start_plan_mode
        ;;
      *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä, –ø–µ—Ä–µ—Ö–æ–¥ –≤ VAN —Ä–µ–∂–∏–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"
        start_van_mode
        ;;
    esac
  else
    echo "üìù –ó–∞–¥–∞—á–∏ –≤ Memory Bank –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    handle_no_tasks_continuation
  fi
}
```

### –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á
```bash
# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á –≤ Memory Bank
find_all_tasks() {
  local tasks_file="memory-bank/tasks.md"
  local archive_dir="memory-bank/archive"

  if [ ! -f "$tasks_file" ]; then
    return 1
  fi

  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
  local active_tasks=$(grep -n "## üéØ.*–ó–ê–î–ê–ß–ê:" "$tasks_file" | head -5)

  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
  local completed_tasks=$(grep -n "## üéØ.*–ó–ê–í–ï–†–®–ï–ù–ù–ê–Ø –ó–ê–î–ê–ß–ê:" "$tasks_file" | head -3)

  # –ê—Ä—Ö–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
  local archived_tasks=""
  if [ -d "$archive_dir" ]; then
    archived_tasks=$(find "$archive_dir" -name "*.md" -exec basename {} \; | head -3)
  fi

  # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
  if [ -n "$active_tasks" ]; then
    echo "üìã –ê–ö–¢–ò–í–ù–´–ï –ó–ê–î–ê–ß–ò:"
    echo "$active_tasks"
    echo ""
  fi

  if [ -n "$completed_tasks" ]; then
    echo "‚úÖ –ó–ê–í–ï–†–®–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò:"
    echo "$completed_tasks"
    echo ""
  fi

  if [ -n "$archived_tasks" ]; then
    echo "üìö –ê–†–•–ò–í–ù–´–ï –ó–ê–î–ê–ß–ò:"
    echo "$archived_tasks"
  fi
}
```

## üîç –ê–ù–ê–õ–ò–ó –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤
```bash
# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
determine_next_steps() {
  local task_name="$1"
  local task_status="$2"

  case "$task_status" in
    *"PLANNED"*|*"0%"*)
      echo "1. –ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (IMPLEMENT)"
      echo "2. –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω (PLAN)"
      echo "3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (CREATIVE)"
      ;;
    *"IMPLEMENT"*|*"[1-4][0-9]%"*)
      echo "1. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (IMPLEMENT)"
      echo "2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (REFLECT)"
      echo "3. –†–µ—à–∏—Ç—å –≤–æ–∑–Ω–∏–∫—à–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (CREATIVE)"
      ;;
    *"[5-8][0-9]%"*)
      echo "1. –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (IMPLEMENT)"
      echo "2. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
      echo "3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
      ;;
    *"[9][0-9]%"*|*"TESTING"*)
      echo "1. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
      echo "2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º"
      echo "3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é (REFLECT)"
      ;;
    *"–ó–ê–í–ï–†–®–ï–ù–ê"*|*"100%"*)
      echo "1. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
      echo "2. –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (REFLECT)"
      echo "3. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á (PLAN)"
      ;;
    *)
      echo "1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (VAN)"
      echo "2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π (PLAN)"
      echo "3. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º (CREATIVE)"
      ;;
  esac
}

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞
recommend_mode_for_task() {
  local task_status="$1"

  case "$task_status" in
    *"PLANNED"*|*"0%"*)
      echo "IMPLEMENT"
      ;;
    *"IMPLEMENT"*|*"[1-7][0-9]%"*)
      echo "IMPLEMENT"
      ;;
    *"[8-9][0-9]%"*)
      echo "REFLECT"
      ;;
    *"–ó–ê–í–ï–†–®–ï–ù–ê"*)
      echo "REFLECT"
      ;;
    *"ERROR"*|*"BLOCKED"*)
      echo "CREATIVE"
      ;;
    *)
      echo "VAN"
      ;;
  esac
}
```

### –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```bash
# –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–µ
analyze_last_activity() {
  local activity_indicators=(
    "memory-bank/tasks.md"
    "memory-bank/progress.md"
    "memory-bank/activeContext.md"
  )

  local latest_file=""
  local latest_time=0

  for file in "${activity_indicators[@]}"; do
    if [ -f "$file" ]; then
      local file_time=$(stat -c %Y "$file" 2>/dev/null || stat -f %m "$file" 2>/dev/null)
      if [ "$file_time" -gt "$latest_time" ]; then
        latest_time="$file_time"
        latest_file="$file"
      fi
    fi
  done

  if [ -n "$latest_file" ]; then
    local last_modified=$(date -d "@$latest_time" "+%Y-%m-%d %H:%M" 2>/dev/null || date -r "$latest_time" "+%Y-%m-%d %H:%M" 2>/dev/null)
    echo "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: $latest_file ($last_modified)"
  else
    echo "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞"
  fi
}
```

## üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ñ–ò–ú–ê–ú–ò

### –ó–∞–ø—É—Å–∫ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
```bash
# –ó–∞–ø—É—Å–∫ IMPLEMENT —Ä–µ–∂–∏–º–∞
start_implement_mode() {
  local task_name="$1"
  echo "‚öôÔ∏è –ó–ê–ü–£–°–ö IMPLEMENT –†–ï–ñ–ò–ú–ê"
  echo "–ó–∞–¥–∞—á–∞: $task_name"
  echo "–†–µ–∂–∏–º: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á"
}

# –ó–∞–ø—É—Å–∫ PLAN —Ä–µ–∂–∏–º–∞
start_plan_mode() {
  local task_name="$1"
  echo "üìã –ó–ê–ü–£–°–ö PLAN –†–ï–ñ–ò–ú–ê"
  echo "–ó–∞–¥–∞—á–∞: ${task_name:-–ù–æ–≤–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ}"
  echo "–†–µ–∂–∏–º: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ"
}

# –ó–∞–ø—É—Å–∫ VAN —Ä–µ–∂–∏–º–∞
start_van_mode() {
  echo "üîç –ó–ê–ü–£–°–ö VAN –†–ï–ñ–ò–ú–ê"
  echo "–†–µ–∂–∏–º: –ê–Ω–∞–ª–∏–∑ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è"

  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ VAN —Ä–µ–∂–∏–º–∞
  van_check_working_directory
  van_check_and_update_date
}

# –ó–∞–ø—É—Å–∫ CREATIVE —Ä–µ–∂–∏–º–∞
start_creative_mode() {
  local task_name="$1"
  echo "üé® –ó–ê–ü–£–°–ö CREATIVE –†–ï–ñ–ò–ú–ê"
  echo "–ó–∞–¥–∞—á–∞: $task_name"
  echo "–†–µ–∂–∏–º: –¢–≤–æ—Ä—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º"
}

# –ó–∞–ø—É—Å–∫ REFLECT —Ä–µ–∂–∏–º–∞
start_reflect_mode() {
  local task_name="$1"
  echo "ü§î –ó–ê–ü–£–°–ö REFLECT –†–ï–ñ–ò–ú–ê"
  echo "–ó–∞–¥–∞—á–∞: $task_name"
  echo "–†–µ–∂–∏–º: –ê–Ω–∞–ª–∏–∑ –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
}
```

## üîß –û–ë–†–ê–ë–û–¢–ö–ê –û–°–û–ë–´–• –°–õ–£–ß–ê–ï–í

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–¥–∞—á
```bash
# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
handle_no_tasks_continuation() {
  echo "üìù –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–°–£–¢–°–¢–í–ò–Ø –ó–ê–î–ê–ß"
  echo "============================"

  echo "–ó–∞–¥–∞—á–∏ –≤ Memory Bank –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."
  echo "üéØ –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π:"
  echo "1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É"
  echo "2. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (VAN —Ä–µ–∂–∏–º)"
  echo "3. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (PLAN —Ä–µ–∂–∏–º)"
  echo "4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Memory Bank"

  read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (1-4): " action_choice

  case "$action_choice" in
    "1")
      echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏..."
      create_new_task
      ;;
    "2")
      echo "üîç –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
      start_van_mode
      ;;
    "3")
      echo "üìã –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è..."
      start_plan_mode
      ;;
    "4")
      echo "üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Memory Bank..."
      initialize_memory_bank
      ;;
    *)
      echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä, –∑–∞–ø—É—Å–∫ VAN —Ä–µ–∂–∏–º–∞"
      start_van_mode
      ;;
  esac
}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Memory Bank
initialize_memory_bank() {
  echo "üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø MEMORY BANK"
  echo "=========================="

  mkdir -p memory-bank/system
  mkdir -p memory-bank/archive

  # –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
  echo "$(date +%Y-%m-%d)" > memory-bank/system/current-date.txt

  cat > memory-bank/tasks.md << EOF
# MEMORY BANK TASKS

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: $(date +%Y-%m-%d)
**–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º**: INIT
**–ê–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

---

## üéØ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê

Memory Bank —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- VAN - –∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- PLAN - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
- CREATIVE - —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- IMPLEMENT - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á
- REFLECT - –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

EOF

  echo "‚úÖ Memory Bank –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
  echo "üîç –ó–∞–ø—É—Å–∫ VAN —Ä–µ–∂–∏–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞"
  start_van_mode
}
```

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã –ü–†–û–î–û–õ–ñ–ê–ô –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å Memory Bank —Å–∏—Å—Ç–µ–º–æ–π.