---
description: "Always apply this rule to implement user request versioning system. Automatically saves request change history in context files to track requirement evolution and maintain development continuity across all Memory Bank modes."
globs: "**/**"
alwaysApply: true
---
# REQUEST VERSIONING SYSTEM (REVIEW LOGIC)

> **TL;DR:** –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å –∏–∑ `LATEST_REQUEST` –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ `REQUEST_HISTORY` —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏, –∞ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç –µ–≥–æ –º–µ—Å—Ç–æ. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –≤—Å–µ–π –±–µ—Å–µ–¥—ã.

## üìú –ü—Ä–æ—Ü–µ—Å—Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

```mermaid
graph TD
    Start["‚ñ∂Ô∏è –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"] --> GetTaskPath["0. –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–µ"]
    GetTaskPath --> ReadContext["1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `_context.md` –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏"]
    ReadContext --> ExtractLatest["2. –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ `LATEST_REQUEST`"]

    ExtractLatest --> HasHistory{"–í `REQUEST_HISTORY`<br>—É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏?"}
    HasHistory -->|"–î–∞"| PrependToHistory["3a. –î–æ–±–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å<br>–≤ –Ω–∞—á–∞–ª–æ `REQUEST_HISTORY` —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π –∏ –¥–∞—Ç–æ–π"]
    HasHistory -->|"–ù–µ—Ç"| CreateHistory["3b. –°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ü–∏—é `REQUEST_HISTORY`<br>–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç—É–¥–∞ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å"]

    PrependToHistory --> UpdateLatest["4. –ü–æ–º–µ—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π<br>–∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>–≤ `LATEST_REQUEST`"]
    CreateHistory --> UpdateLatest

    UpdateLatest --> SaveContext["5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π<br>`_context.md` –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏"]
    SaveContext --> Proceed["‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω.<br>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã."]

    style Start fill:#f8d486,stroke:#e8b84d,color:black
    style Proceed fill:#5fd94d,stroke:#3da336,color:white
```

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **–¥–æ** –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ª—é–±–æ–≥–æ —Ä–µ–∂–∏–º–∞ (`VAN`, `PLAN` –∏ —Ç.–¥.).

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `_context.md`:

```bash
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ –¥–ª—è –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

# 1. –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
new_request = get_user_prompt()

# 2. –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–µ
active_task_path=$(get_active_task_path)
if [ -z "$active_task_path" ]; then
  echo "‚ùå No active task found. Cannot save request history." >&2
  exit 1
fi

context_file=$(get_context_file_path)
if [ -z "$context_file" ]; then
  echo "‚ùå No active task. Cannot version request." >&2
  exit 1
fi

# 3. –ß–∏—Ç–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
context_content = read_file("$context_file")

# 4. –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å
# (–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–µ–∂–¥—É ```)
last_request_text = extract_between_markers(context_content, "LATEST_REQUEST", "```")

# 5. –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
timestamp = get_current_datetime()
history_entry = f"- **v1.X ({timestamp}):**\\n  \`\`\`\\n  {last_request_text}\\n  \`\`\`"

# 6. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
# –ó–∞–º–µ–Ω—è–µ–º LATEST_REQUEST –Ω–∞ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
updated_content = replace_section(context_content, "LATEST_REQUEST", new_request)
# –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ REQUEST_HISTORY
updated_content = prepend_to_section(updated_content, "REQUEST_HISTORY", history_entry)

# 7. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
edit_file("$context_file", updated_content)
```

**–≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–∏ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω.**
